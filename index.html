<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>漂泊的个人笔记</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="漂泊的个人笔记">
<meta property="og:url" content="http://pcbopcbo.github.io/index.html">
<meta property="og:site_name" content="漂泊的个人笔记">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="thf">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="漂泊的个人笔记" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">漂泊的个人笔记</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/index.html">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://pcbopcbo.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-hello-world" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/06/15/hello-world/" class="article-date">
  <time datetime="2021-06-15T07:02:13.394Z" itemprop="datePublished">2021-06-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/06/15/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://pcbopcbo.github.io/2021/06/15/hello-world/" data-id="ckpxpgioh002wccubcniyfrys" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-2021061500" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/06/15/2021061500/" class="article-date">
  <time datetime="2021-06-15T02:54:02.000Z" itemprop="datePublished">2021-06-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%A4%87%E8%AE%B0/">备记</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/06/15/2021061500/">临时性备记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://pcbopcbo.github.io/2021/06/15/2021061500/" data-id="ckpxpgiog002uccub14qu8yyz" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%93%BE%E6%8E%A5%E6%94%B6%E9%9B%86/" rel="tag">链接收集</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2020082411" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/08/24/2020082411/" class="article-date">
  <time datetime="2020-08-24T02:54:02.000Z" itemprop="datePublished">2020-08-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%A4%87%E8%AE%B0/">备记</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/08/24/2020082411/">如何防止git使用的时候的冲突与解决冲突</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="如何防止git使用的时候的冲突"><a href="#如何防止git使用的时候的冲突" class="headerlink" title="如何防止git使用的时候的冲突"></a>如何防止git使用的时候的冲突</h2><h3 id="绝对新手"><a href="#绝对新手" class="headerlink" title="绝对新手"></a>绝对新手</h3><ol>
<li>每次修改前pull（拉取）</li>
<li>修改后stash save(保存贮藏)</li>
<li>pull(拉取)</li>
<li>stash pop（弹出贮藏），如果这个时候有冲突，自行合并后删除贮藏！</li>
<li>commit &amp; push （提交并推送）（较小可能冲突）</li>
</ol>
<h3 id="第二阶段"><a href="#第二阶段" class="headerlink" title="第二阶段"></a>第二阶段</h3><ol>
<li>每次修改前pull（拉取）</li>
<li>pull(拉取)</li>
<li>因为冲突拉取失败的时候，重复《绝对新手》的2-5步骤</li>
</ol>
<h3 id="第三阶段"><a href="#第三阶段" class="headerlink" title="第三阶段"></a>第三阶段</h3><ol>
<li>本地修改后commit（提交）未推送（push）</li>
<li>此时远程1-2-3，本地1-2-4，直接pull的时候会导致merge</li>
<li>本地混合重置到1-2，工作副本内容保持在1-2-4</li>
<li>拉取（因为冲突拉取失败的时候，重复《绝对新手》的2-5步骤）</li>
</ol>
<h3 id="第四阶段"><a href="#第四阶段" class="headerlink" title="第四阶段"></a>第四阶段</h3><ol>
<li>本地修改后commit（提交）未推送（push）</li>
<li>此时远程1-2-3，本地1-2-4，直接pull的时候会导致merge</li>
<li>记住4的sha值，硬重置到2，本地变成1-2，工作副本内容也变成1-2</li>
<li>pull(拉取)，本地1-2-3，副本1-2-3，摘取提交点4（这里用到前面用到的4的sha值），如果有冲突自己解决</li>
<li>推送（push）</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://pcbopcbo.github.io/2020/08/24/2020082411/" data-id="ckpxpgioe002sccubhhgx8f4o" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/git/" rel="tag">git</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2020081410" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/08/14/2020081410/" class="article-date">
  <time datetime="2020-08-14T08:54:02.000Z" itemprop="datePublished">2020-08-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%8B%93%E5%B1%95/">拓展</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/08/14/2020081410/">redis数据结构与底层</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Redis的数据结构"><a href="#Redis的数据结构" class="headerlink" title="Redis的数据结构"></a>Redis的数据结构</h2><h3 id="基本数据结构"><a href="#基本数据结构" class="headerlink" title="基本数据结构"></a>基本数据结构</h3><ul>
<li><p>String 字符串</p>
</li>
<li><p>Hash  散列</p>
</li>
<li><p>List 列表</p>
</li>
<li><p>Set 集合</p>
</li>
<li><p>Sorted Set 有序集合</p>
</li>
</ul>
<h3 id="进阶"><a href="#进阶" class="headerlink" title="进阶"></a>进阶</h3><ul>
<li><p>bitmap 位图</p>
</li>
<li><p>GeoHash</p>
</li>
<li><p>HyperLogLogs</p>
</li>
</ul>
<h3 id="终极"><a href="#终极" class="headerlink" title="终极"></a>终极</h3><ul>
<li>Streams</li>
</ul>
<h2 id="Redis的内部编码"><a href="#Redis的内部编码" class="headerlink" title="Redis的内部编码"></a>Redis的内部编码</h2><ul>
<li><p>int</p>
</li>
<li><p>raw </p>
</li>
<li><p>embstr</p>
</li>
<li><p>linkedList</p>
</li>
<li><p>zipList</p>
</li>
<li><p>skipList</p>
</li>
<li><p>hashTable</p>
</li>
<li><p>intset</p>
</li>
</ul>
<ol>
<li><p>String(int raw embstr)</p>
</li>
<li><p>List(linkedList zipList)</p>
</li>
<li><p>sortedSet(zipList skipList)</p>
</li>
<li><p>Hash(zipList hashTable)</p>
</li>
<li><p>Set(hashTable intset)</p>
</li>
</ol>
<h2 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h2><ol>
<li><p>缓存（随机访问速度，Disk是ms级别，SSD是微秒级别，内存则是纳秒级别）</p>
</li>
<li><p>计数器</p>
</li>
<li><p>分布式ID生成（步进）</p>
</li>
<li><p>海量数据统计（bitmap）</p>
</li>
<li><p>会话缓存（应用会话缓存存储，保证应用的高可用可伸缩性）</p>
</li>
<li><p>分布式队列、阻塞队列（List，lpush/rpush rpop/lpop  读取写入数据）</p>
</li>
<li><p>分布式锁（setNx）</p>
</li>
<li><p>热点数据存储（list结构，ltrim）</p>
</li>
<li><p>社交需求</p>
<p> set交集（共同好友），set差集（好友推荐、文章推荐），排行榜zset</p>
</li>
<li><p>延迟队列（[时间戳+需要延迟时间]，score，消息内容作为元素，zadd生产消息，消费者使用zrangeByScore获取当前时间之前的数据，然后rem key）</p>
</li>
</ol>
<h2 id="redis的二进制数据安全特性-binary-safe"><a href="#redis的二进制数据安全特性-binary-safe" class="headerlink" title="redis的二进制数据安全特性 binary safe"></a>redis的二进制数据安全特性 binary safe</h2><pre><code>redis的String类型不同于C语言的string类型

redis的String=&gt;SDS（Simple Dynamic String）
</code></pre>
<h3 id="SDS的结构"><a href="#SDS的结构" class="headerlink" title="SDS的结构"></a>SDS的结构</h3><h4 id="3-2前"><a href="#3-2前" class="headerlink" title="3.2前"></a>3.2前</h4><pre><code>SDS=&gt;len（int），free（int），buffer（string）
</code></pre>
<h4 id="3-2后"><a href="#3-2后" class="headerlink" title="3.2后"></a>3.2后</h4><pre><code>SDS=&gt;5种string类型

SDS_TYPE_5， SDS_TYPE_8， SDS_TYPE_16， SDS_TYPE_32， SDS_TYPE_64

。。。
</code></pre>
<h2 id="内存与分配机制"><a href="#内存与分配机制" class="headerlink" title="内存与分配机制"></a>内存与分配机制</h2><pre><code>Redis扩容=&gt;(需加大小+原大小)x2
</code></pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://pcbopcbo.github.io/2020/08/14/2020081410/" data-id="ckpxpgiod002rccubgrct8d1v" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/redis/" rel="tag">redis</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%BC%80%E5%8F%91/" rel="tag">开发</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2020071517" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/07/15/2020071517/" class="article-date">
  <time datetime="2020-07-15T08:54:02.000Z" itemprop="datePublished">2020-07-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%8B%93%E5%B1%95/">拓展</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/07/15/2020071517/">简单代码片段</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="自己写的求最大子串"><a href="#自己写的求最大子串" class="headerlink" title="自己写的求最大子串"></a>自己写的求最大子串</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"> static int[] arr=&#123;1, -2, 3, 10, -4, -7, 2, -5, -99, 10, 45, -4 ,5&#125;;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void test91()&#123;</span><br><span class="line"></span><br><span class="line">        int[] resut=getSubArr(arr);</span><br><span class="line">        System.out.println(&quot;最大子串=&quot;+StringUtils.join(Arrays.copyOfRange(arr,resut[0],resut[1]+1),&#x27;,&#x27;));</span><br><span class="line">        System.out.println(&quot;左侧=&quot;+resut[0]+&quot;,右侧=&quot;+resut[1]+&quot;,最大值=&quot;+resut[2]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static int[] getSubArr(int[] arr)&#123;</span><br><span class="line"></span><br><span class="line">        int[] mArr=new int[arr.length],leftArr=new int[arr.length];</span><br><span class="line">        mArr[0]=arr[0];</span><br><span class="line">        leftArr[0]=0;</span><br><span class="line">        int right=0;</span><br><span class="line">        int max=arr[0];</span><br><span class="line">        int maxIndex=0;</span><br><span class="line">        for (int i=1;i&lt;arr.length;i++)&#123;</span><br><span class="line">            if(max&gt;0)&#123;</span><br><span class="line">                max+=arr[i];</span><br><span class="line">                leftArr[i]=leftArr[i-1];</span><br><span class="line">            &#125;else &#123;</span><br><span class="line">                max=arr[i];</span><br><span class="line">                leftArr[i]=i;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            mArr[i]=max;</span><br><span class="line">            if(mArr[maxIndex]&lt;max)&#123;</span><br><span class="line">                right=maxIndex=i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return new int[]&#123;leftArr[maxIndex],right,mArr[maxIndex]&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">//  别人写的求最大子串和</span><br><span class="line">    @Test</span><br><span class="line">    public void test92()&#123;</span><br><span class="line"></span><br><span class="line">        int max = arr[0];</span><br><span class="line">          int res = arr[0];</span><br><span class="line">          for (int i = 1; i &lt; arr.length; i++) &#123;</span><br><span class="line">           // 让i-1的最优解和i比较</span><br><span class="line">           max = Math.max(max+arr[i], arr[i]);</span><br><span class="line">           res = Math.max(max, res);</span><br><span class="line">           System.out.println(&quot;up value:&quot; + max + &quot;当前索引的值:&quot; + i);</span><br><span class="line">          &#125;</span><br><span class="line">        System.out.println(&quot;最大值=&quot;+res);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="自己写的快排"><a href="#自己写的快排" class="headerlink" title="自己写的快排"></a>自己写的快排</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">private static void swap(int[] a,int l,int r)&#123;</span><br><span class="line">		if(l==r)return;</span><br><span class="line">		a[l]=a[l]+a[r];</span><br><span class="line">		a[r]=a[l]-a[r];</span><br><span class="line">		a[l]=a[l]-a[r];</span><br><span class="line">	&#125;</span><br><span class="line">	public static void sort(int[] a,int l,int r)&#123;</span><br><span class="line">		if(l&gt;=r)return;</span><br><span class="line">		int k=partition(a, l, r);</span><br><span class="line">		swap(a, l, k);</span><br><span class="line">		sort(a, l, k-1);</span><br><span class="line">		sort(a, k+1, r);</span><br><span class="line">	&#125; </span><br><span class="line">	public static int partition(int[] a,int l,int r)&#123;</span><br><span class="line">		int base=a[l];</span><br><span class="line">		while(l&lt;r)&#123;</span><br><span class="line">			while(l&lt;r&amp;&amp;a[r]&gt;=base)&#123;</span><br><span class="line">				r--;</span><br><span class="line">			&#125;</span><br><span class="line">			while(l&lt;r&amp;&amp;a[l]&lt;=base)&#123;</span><br><span class="line">				l++;</span><br><span class="line">			&#125;</span><br><span class="line">			if(l&lt;r)</span><br><span class="line">				swap(a,l,r);</span><br><span class="line">		&#125;</span><br><span class="line">		return l;</span><br><span class="line">	&#125;</span><br><span class="line">	@Test</span><br><span class="line">	public void testSwap()&#123;</span><br><span class="line">		int[] a=&#123;1,2,3&#125;;</span><br><span class="line">		swap(a, 0, 2);</span><br><span class="line">		System.out.println(StringUtils.join(ArrayUtils.toObject(a), &#x27;,&#x27;));</span><br><span class="line">	&#125;</span><br><span class="line">	@Test</span><br><span class="line">	public void testSort()&#123;</span><br><span class="line">		int[] a=&#123;6,5,1,2,4,1,4,3,2,1&#125;;</span><br><span class="line">		sort(a, 0, a.length-1);</span><br><span class="line">		System.out.println(StringUtils.join(ArrayUtils.toObject(a), &#x27;,&#x27;));</span><br><span class="line">		Arrays.sort(a);</span><br><span class="line">		System.out.println(StringUtils.join(ArrayUtils.toObject(a), &#x27;,&#x27;));</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h3 id="网上的快排例子"><a href="#网上的快排例子" class="headerlink" title="网上的快排例子"></a>网上的快排例子</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">// 快速排序 ************************************</span><br><span class="line">public static void QuickSort(int[] a, int left, int right) &#123;</span><br><span class="line">	// 如果 left 等于 right，即数组只有一个元素，直接返回</span><br><span class="line">	if (left &gt;= right) &#123;</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line">	// 设置最左边的元素为基准值</span><br><span class="line">	int key = a[left];</span><br><span class="line">	// 数组中比 key 小的放在左边，比 key 大的放在右边，key 值下标为 i</span><br><span class="line">	int i = left;</span><br><span class="line">	int j = right;</span><br><span class="line">	while (i &lt; j) &#123;</span><br><span class="line">		// j 向左移，直到遇到比 key 小的值</span><br><span class="line">		while (a[j] &gt;= key &amp;&amp; i &lt; j) &#123;</span><br><span class="line">			j--;</span><br><span class="line">		&#125;</span><br><span class="line">		// i 向右移，直到遇到比 key 大的值</span><br><span class="line">		while (a[i] &lt;= key &amp;&amp; i &lt; j) &#123;</span><br><span class="line">			i++;</span><br><span class="line">		&#125;</span><br><span class="line">		// i 和 j 指向的元素交换</span><br><span class="line">		if (i &lt; j) &#123;</span><br><span class="line">			int temp = a[i];</span><br><span class="line">			a[i] = a[j];</span><br><span class="line">			a[j] = temp;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	a[left] = a[i];</span><br><span class="line">	a[i] = key;</span><br><span class="line">	QuickSort(a, left, i - 1);</span><br><span class="line">	QuickSort(a, i + 1, right);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private static void print(int[] a)&#123;</span><br><span class="line">	for (int i : a) &#123;</span><br><span class="line">		System.out.print(&quot;,&quot;+i);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">@Test</span><br><span class="line">public void testSort() &#123;</span><br><span class="line">	int[] a = &#123; 6,5,4,3,2,1&#125;;</span><br><span class="line">	QuickSort(a, 0, a.length - 1);</span><br><span class="line">	print(a);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public class RegexDemo &#123;</span><br><span class="line"></span><br><span class="line">	@Test</span><br><span class="line">	public void replaceTest()&#123;</span><br><span class="line">		System.out.println(&quot;sljfls,,,,&quot;.replaceAll(&quot;,+$&quot;, &quot;&quot;));</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	@Test</span><br><span class="line">	public void replaceTest1()&#123;</span><br><span class="line">		List&lt;String&gt; list=Arrays.asList(&quot;000&quot;,&quot;010&quot;,&quot;099&quot;,&quot;800&quot;,&quot;990&quot;,&quot;909&quot;,&quot;009&quot;,&quot;0&quot;,&quot;09&quot;,&quot;90&quot;,&quot;8&quot;,&quot;00&quot;);</span><br><span class="line">		for(String s:list)</span><br><span class="line">		System.out.println(s+&quot;-&gt;&quot;+s.replaceAll(&quot;^0&#123;1,2&#125;(?=\\d&#123;1,2&#125;)&quot;, &quot;&quot;));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="雪花算法"><a href="#雪花算法" class="headerlink" title="雪花算法"></a>雪花算法</h3><p><a href="https://pcbopcbo.github.io/files/SeqUtil.java">参考网上例子</a></p>
<p><a href="https://pcbopcbo.github.io/files/GenerateKey.java">好像记得有bug的。。魔改版</a></p>
<p><a href="https://pcbopcbo.github.io/files/GenerateKeyTest.java">魔改版魔改测试类</a></p>
<p><a href="https://pcbopcbo.github.io/files/CurrentExcuteInfo.java">获取当前方法名(堆栈中获取)</a></p>
<blockquote>
<p>DateHelper没啥用处就不列了</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://pcbopcbo.github.io/2020/07/15/2020071517/" data-id="ckpxpginc0014ccube2m8hsuh" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mybatis/" rel="tag">mybatis</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%BC%80%E5%8F%91/" rel="tag">开发</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2020071017" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/07/10/2020071017/" class="article-date">
  <time datetime="2020-07-10T09:17:34.000Z" itemprop="datePublished">2020-07-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%A4%87%E8%AE%B0/">备记</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/07/10/2020071017/">Mybatis简单阅读code</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="简单阅读code"><a href="#简单阅读code" class="headerlink" title="简单阅读code"></a>简单阅读code</h2><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/68835431">其他人的例子</a></p>
<p><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000023097250">深度分析：mybatis的底层实现原理</a></p>
<h2 id="简单阅读code记录"><a href="#简单阅读code记录" class="headerlink" title="简单阅读code记录"></a>简单阅读code记录</h2><h3 id="自己的随手记-单一个mybatis，版本3-5-3"><a href="#自己的随手记-单一个mybatis，版本3-5-3" class="headerlink" title="自己的随手记  单一个mybatis，版本3.5.3"></a>自己的随手记  单一个mybatis，版本3.5.3</h3><h5 id="MybatisSetUp-java"><a href="#MybatisSetUp-java" class="headerlink" title="MybatisSetUp.java"></a>MybatisSetUp.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">String resource = <span class="string">&quot;mybatis-config.xml&quot;</span>;</span><br><span class="line">		InputStream inputStream=<span class="keyword">null</span>;</span><br><span class="line">		SqlSession sqlSession=<span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			inputStream = Resources.getResourceAsStream(resource);</span><br><span class="line">			SqlSessionFactory sqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(inputStream,<span class="string">&quot;mysql&quot;</span>);</span><br><span class="line"></span><br><span class="line">			sqlSession=sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">			<span class="keyword">try</span>&#123;</span><br><span class="line">				LockDemoMapper lockDemoMapper=sqlSession.getMapper(LockDemoMapper.class);</span><br><span class="line">				LockDemo lockDemo=lockDemoMapper.selectBalance(<span class="number">1</span>);</span><br><span class="line">				String resultString=ReflectionToStringBuilder.toString(lockDemo);</span><br><span class="line">				logger.info(<span class="string">&quot;查询结果=&#123;&#125;&quot;</span>,resultString);</span><br><span class="line"></span><br><span class="line">				lockDemoMapper.addBalance(<span class="keyword">new</span> BigDecimal(<span class="string">&quot;1.3&quot;</span>),<span class="number">1</span>);</span><br><span class="line">				sqlSession.commit();</span><br><span class="line"></span><br><span class="line">			&#125;<span class="keyword">catch</span> (Throwable t)&#123;</span><br><span class="line">				logger.error(<span class="string">&quot;&#123;&#125;&quot;</span>,t);</span><br><span class="line">				<span class="keyword">if</span>(sqlSession!=<span class="keyword">null</span>)&#123;</span><br><span class="line">					sqlSession.rollback();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">			logger.error(<span class="string">&quot;&quot;</span>,e);</span><br><span class="line"></span><br><span class="line">		&#125; <span class="keyword">finally</span>&#123;</span><br><span class="line">			<span class="keyword">if</span>(sqlSession!=<span class="keyword">null</span>)&#123;</span><br><span class="line">				sqlSession.close();</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(inputStream!=<span class="keyword">null</span>)&#123;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					inputStream.close();</span><br><span class="line">				&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">					logger.error(<span class="string">&quot;&quot;</span>,e);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>

<h4 id="获取SqlSessionFactory"><a href="#获取SqlSessionFactory" class="headerlink" title="获取SqlSessionFactory"></a>获取SqlSessionFactory</h4><h5 id="解析配置文件"><a href="#解析配置文件" class="headerlink" title="解析配置文件"></a>解析配置文件</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream,&quot;mysql&quot;);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">parseConfiguration:106, XMLConfigBuilder (org.apache.ibatis.builder.xml)</span><br><span class="line">parse:98, XMLConfigBuilder (org.apache.ibatis.builder.xml)</span><br><span class="line">build:78, SqlSessionFactoryBuilder (org.apache.ibatis.session)</span><br><span class="line">build:68, SqlSessionFactoryBuilder (org.apache.ibatis.session)</span><br><span class="line">main:27, MybatisSetUp (cn.demo.stdemo)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="构建org-apache-ibatis-session-Configuration"><a href="#构建org-apache-ibatis-session-Configuration" class="headerlink" title="构建org.apache.ibatis.session.Configuration"></a>构建org.apache.ibatis.session.Configuration</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">private void parseConfiguration(XNode root) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            this.propertiesElement(root.evalNode(&quot;properties&quot;));</span><br><span class="line">            Properties settings = this.settingsAsProperties(root.evalNode(&quot;settings&quot;));</span><br><span class="line">            this.loadCustomVfs(settings);</span><br><span class="line">            this.loadCustomLogImpl(settings);</span><br><span class="line">            this.typeAliasesElement(root.evalNode(&quot;typeAliases&quot;));</span><br><span class="line">            this.pluginElement(root.evalNode(&quot;plugins&quot;));</span><br><span class="line">            this.objectFactoryElement(root.evalNode(&quot;objectFactory&quot;));</span><br><span class="line">            this.objectWrapperFactoryElement(root.evalNode(&quot;objectWrapperFactory&quot;));</span><br><span class="line">            this.reflectorFactoryElement(root.evalNode(&quot;reflectorFactory&quot;));</span><br><span class="line">            this.settingsElement(settings);</span><br><span class="line">            this.environmentsElement(root.evalNode(&quot;environments&quot;));</span><br><span class="line">            this.databaseIdProviderElement(root.evalNode(&quot;databaseIdProvider&quot;));</span><br><span class="line">            this.typeHandlerElement(root.evalNode(&quot;typeHandlers&quot;));</span><br><span class="line">            this.mapperElement(root.evalNode(&quot;mappers&quot;));</span><br><span class="line">        &#125; catch (Exception var3) &#123;</span><br><span class="line">            throw new BuilderException(&quot;Error parsing SQL Mapper Configuration. Cause: &quot; + var3, var3);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h5 id="构建org-apache-ibatis-binding-MapperRegistry"><a href="#构建org-apache-ibatis-binding-MapperRegistry" class="headerlink" title="构建org.apache.ibatis.binding.MapperRegistry"></a>构建org.apache.ibatis.binding.MapperRegistry</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mapperElement:362, XMLConfigBuilder (org.apache.ibatis.builder.xml)</span><br><span class="line">parseConfiguration:119, XMLConfigBuilder (org.apache.ibatis.builder.xml)</span><br><span class="line">parse:98, XMLConfigBuilder (org.apache.ibatis.builder.xml)</span><br><span class="line">build:78, SqlSessionFactoryBuilder (org.apache.ibatis.session)</span><br><span class="line">build:68, SqlSessionFactoryBuilder (org.apache.ibatis.session)</span><br><span class="line">main:27, MybatisSetUp (cn.demo.stdemo)</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">private void mapperElement(XNode parent) throws Exception &#123;</span><br><span class="line">        if (parent != null) &#123;</span><br><span class="line">            Iterator var2 = parent.getChildren().iterator();</span><br><span class="line"></span><br><span class="line">            while(true) &#123;</span><br><span class="line">                while(var2.hasNext()) &#123;</span><br><span class="line">                    XNode child = (XNode)var2.next();</span><br><span class="line">                    String resource;</span><br><span class="line">                    if (&quot;package&quot;.equals(child.getName())) &#123;</span><br><span class="line">                        resource = child.getStringAttribute(&quot;name&quot;);</span><br><span class="line">                        this.configuration.addMappers(resource);</span><br><span class="line">                    &#125; else &#123;</span><br><span class="line">                        resource = child.getStringAttribute(&quot;resource&quot;);</span><br><span class="line">                        String url = child.getStringAttribute(&quot;url&quot;);</span><br><span class="line">                        String mapperClass = child.getStringAttribute(&quot;class&quot;);</span><br><span class="line">                        XMLMapperBuilder mapperParser;</span><br><span class="line">                        InputStream inputStream;</span><br><span class="line">                        if (resource != null &amp;&amp; url == null &amp;&amp; mapperClass == null) &#123;</span><br><span class="line">                            ErrorContext.instance().resource(resource);</span><br><span class="line">                            inputStream = Resources.getResourceAsStream(resource);</span><br><span class="line">                            mapperParser = new XMLMapperBuilder(inputStream, this.configuration, resource, this.configuration.getSqlFragments());</span><br><span class="line">                            mapperParser.parse();</span><br><span class="line">                        &#125; else if (resource == null &amp;&amp; url != null &amp;&amp; mapperClass == null) &#123;</span><br><span class="line">                            ErrorContext.instance().resource(url);</span><br><span class="line">                            inputStream = Resources.getUrlAsStream(url);</span><br><span class="line">                            mapperParser = new XMLMapperBuilder(inputStream, this.configuration, url, this.configuration.getSqlFragments());</span><br><span class="line">                            mapperParser.parse();</span><br><span class="line">                        &#125; else &#123;</span><br><span class="line">                            if (resource != null || url != null || mapperClass == null) &#123;</span><br><span class="line">                                throw new BuilderException(&quot;A mapper element may only specify a url, resource or class, but not more than one.&quot;);</span><br><span class="line">                            &#125;</span><br><span class="line"></span><br><span class="line">                            Class&lt;?&gt; mapperInterface = Resources.classForName(mapperClass);</span><br><span class="line">                            this.configuration.addMapper(mapperInterface);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="plugin"><a href="#plugin" class="headerlink" title="plugin"></a>plugin</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">addInterceptor:37, InterceptorChain (org.apache.ibatis.plugin)</span><br><span class="line">addInterceptor:763, Configuration (org.apache.ibatis.session)</span><br><span class="line">pluginElement:190, XMLConfigBuilder (org.apache.ibatis.builder.xml)</span><br><span class="line">parseConfiguration:110, XMLConfigBuilder (org.apache.ibatis.builder.xml)</span><br><span class="line">parse:98, XMLConfigBuilder (org.apache.ibatis.builder.xml)</span><br><span class="line">build:78, SqlSessionFactoryBuilder (org.apache.ibatis.session)</span><br><span class="line">build:68, SqlSessionFactoryBuilder (org.apache.ibatis.session)</span><br><span class="line">main:27, MybatisSetUp (cn.demo.stdemo)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">private void pluginElement(XNode parent) throws Exception &#123;</span><br><span class="line">        if (parent != null) &#123;</span><br><span class="line">            Iterator var2 = parent.getChildren().iterator();</span><br><span class="line"></span><br><span class="line">            while(var2.hasNext()) &#123;</span><br><span class="line">                XNode child = (XNode)var2.next();</span><br><span class="line">                String interceptor = child.getStringAttribute(&quot;interceptor&quot;);</span><br><span class="line">                Properties properties = child.getChildrenAsProperties();</span><br><span class="line">                Interceptor interceptorInstance = (Interceptor)this.resolveClass(interceptor).getDeclaredConstructor().newInstance();</span><br><span class="line">                interceptorInstance.setProperties(properties);</span><br><span class="line">                this.configuration.addInterceptor(interceptorInstance);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h6 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;init&gt;:40, Plugin (org.apache.ibatis.plugin)</span><br><span class="line">wrap:49, Plugin (org.apache.ibatis.plugin)</span><br><span class="line">plugin:28, Interceptor (org.apache.ibatis.plugin)</span><br><span class="line">pluginAll:31, InterceptorChain (org.apache.ibatis.plugin)</span><br><span class="line">newExecutor:615, Configuration (org.apache.ibatis.session)</span><br><span class="line">openSessionFromDataSource:96, DefaultSqlSessionFactory (org.apache.ibatis.session.defaults)</span><br><span class="line">openSession:47, DefaultSqlSessionFactory (org.apache.ibatis.session.defaults)</span><br><span class="line">main:29, MybatisSetUp (cn.demo.stdemo)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="sqlSession-sqlSessionFactory-openSession"><a href="#sqlSession-sqlSessionFactory-openSession" class="headerlink" title="sqlSession=sqlSessionFactory.openSession();"></a>sqlSession=sqlSessionFactory.openSession();</h4><h5 id="关于plugin部分"><a href="#关于plugin部分" class="headerlink" title="关于plugin部分"></a>关于plugin部分</h5><h6 id="调用到Plugin"><a href="#调用到Plugin" class="headerlink" title="调用到Plugin"></a>调用到Plugin</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">invoke:61, Plugin (org.apache.ibatis.plugin)</span><br><span class="line">update:-1, $Proxy5 (com.sun.proxy)</span><br><span class="line">update:197, DefaultSqlSession (org.apache.ibatis.session.defaults)</span><br><span class="line">execute:67, MapperMethod (org.apache.ibatis.binding)</span><br><span class="line">invoke:93, MapperProxy (org.apache.ibatis.binding)</span><br><span class="line">addBalance:-1, $Proxy6 (com.sun.proxy)</span><br><span class="line">main:37, MybatisSetUp (cn.demo.stdemo)</span><br></pre></td></tr></table></figure>

<h6 id="Plugin-反射-Intercept"><a href="#Plugin-反射-Intercept" class="headerlink" title="Plugin 反射 Intercept"></a>Plugin 反射 Intercept</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">intercept:27, ExamplePlugin (cn.demo.stdemo.plugin)</span><br><span class="line">invoke:61, Plugin (org.apache.ibatis.plugin)</span><br><span class="line">update:-1, $Proxy5 (com.sun.proxy)</span><br><span class="line">update:197, DefaultSqlSession (org.apache.ibatis.session.defaults)</span><br><span class="line">execute:67, MapperMethod (org.apache.ibatis.binding)</span><br><span class="line">invoke:93, MapperProxy (org.apache.ibatis.binding)</span><br><span class="line">addBalance:-1, $Proxy6 (com.sun.proxy)</span><br><span class="line">main:37, MybatisSetUp (cn.demo.stdemo)</span><br></pre></td></tr></table></figure>

<h4 id="获取mapper"><a href="#获取mapper" class="headerlink" title="获取mapper"></a>获取mapper</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">newInstance:424, Constructor (java.lang.reflect)</span><br><span class="line">newProxyInstance:739, Proxy (java.lang.reflect)</span><br><span class="line">newInstance:47, MapperProxyFactory (org.apache.ibatis.binding)</span><br><span class="line">newInstance:52, MapperProxyFactory (org.apache.ibatis.binding)</span><br><span class="line">getMapper:50, MapperRegistry (org.apache.ibatis.binding)</span><br><span class="line">getMapper:779, Configuration (org.apache.ibatis.session)</span><br><span class="line">getMapper:291, DefaultSqlSession (org.apache.ibatis.session.defaults)</span><br><span class="line">main:32, MybatisSetUp (cn.demo.stdemo)</span><br></pre></td></tr></table></figure>

<h5 id="sql"><a href="#sql" class="headerlink" title="sql"></a>sql</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">parseStatementNode:57, XMLStatementBuilder (org.apache.ibatis.builder.xml)</span><br><span class="line">buildStatementFromContext:137, XMLMapperBuilder (org.apache.ibatis.builder.xml)</span><br><span class="line">buildStatementFromContext:130, XMLMapperBuilder (org.apache.ibatis.builder.xml)</span><br><span class="line">configurationElement:120, XMLMapperBuilder (org.apache.ibatis.builder.xml)</span><br><span class="line">parse:94, XMLMapperBuilder (org.apache.ibatis.builder.xml)</span><br><span class="line">mapperElement:374, XMLConfigBuilder (org.apache.ibatis.builder.xml)</span><br><span class="line">parseConfiguration:119, XMLConfigBuilder (org.apache.ibatis.builder.xml)</span><br><span class="line">parse:98, XMLConfigBuilder (org.apache.ibatis.builder.xml)</span><br><span class="line">build:78, SqlSessionFactoryBuilder (org.apache.ibatis.session)</span><br><span class="line">build:68, SqlSessionFactoryBuilder (org.apache.ibatis.session)</span><br><span class="line">main:27, MybatisSetUp (cn.demo.stdemo)</span><br></pre></td></tr></table></figure>


<h5 id="resultHandler"><a href="#resultHandler" class="headerlink" title="resultHandler"></a>resultHandler</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">handleResult:43, DefaultResultHandler (org.apache.ibatis.executor.result)</span><br><span class="line">callResultHandler:370, DefaultResultSetHandler (org.apache.ibatis.executor.resultset)</span><br><span class="line">storeObject:363, DefaultResultSetHandler (org.apache.ibatis.executor.resultset)</span><br><span class="line">handleRowValuesForSimpleResultMap:355, DefaultResultSetHandler (org.apache.ibatis.executor.resultset)</span><br><span class="line">handleRowValues:328, DefaultResultSetHandler (org.apache.ibatis.executor.resultset)</span><br><span class="line">handleResultSet:301, DefaultResultSetHandler (org.apache.ibatis.executor.resultset)</span><br><span class="line">handleResultSets:194, DefaultResultSetHandler (org.apache.ibatis.executor.resultset)</span><br><span class="line">query:65, PreparedStatementHandler (org.apache.ibatis.executor.statement)</span><br><span class="line">query:79, RoutingStatementHandler (org.apache.ibatis.executor.statement)</span><br><span class="line">doQuery:63, SimpleExecutor (org.apache.ibatis.executor)</span><br><span class="line">queryFromDatabase:324, BaseExecutor (org.apache.ibatis.executor)</span><br><span class="line">query:156, BaseExecutor (org.apache.ibatis.executor)</span><br><span class="line">query:109, CachingExecutor (org.apache.ibatis.executor)</span><br><span class="line">query:83, CachingExecutor (org.apache.ibatis.executor)</span><br><span class="line">invoke0:-1, NativeMethodAccessorImpl (sun.reflect)</span><br><span class="line">invoke:62, NativeMethodAccessorImpl (sun.reflect)</span><br><span class="line">invoke:43, DelegatingMethodAccessorImpl (sun.reflect)</span><br><span class="line">invoke:498, Method (java.lang.reflect)</span><br><span class="line">invoke:63, Plugin (org.apache.ibatis.plugin)</span><br><span class="line">query:-1, $Proxy5 (com.sun.proxy)</span><br><span class="line">selectList:147, DefaultSqlSession (org.apache.ibatis.session.defaults)</span><br><span class="line">selectList:140, DefaultSqlSession (org.apache.ibatis.session.defaults)</span><br><span class="line">selectOne:76, DefaultSqlSession (org.apache.ibatis.session.defaults)</span><br><span class="line">execute:87, MapperMethod (org.apache.ibatis.binding)</span><br><span class="line">invoke:93, MapperProxy (org.apache.ibatis.binding)</span><br><span class="line">selectBalance:-1, $Proxy6 (com.sun.proxy)</span><br><span class="line">main:33, MybatisSetUp (cn.demo.stdemo)</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://pcbopcbo.github.io/2020/07/10/2020071017/" data-id="ckpxpginb0012ccub6to4ekn9" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mybatis/" rel="tag">mybatis</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%BC%80%E5%8F%91/" rel="tag">开发</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2020070716" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/07/07/2020070716/" class="article-date">
  <time datetime="2020-07-07T08:05:11.000Z" itemprop="datePublished">2020-07-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%BD%AC%E8%BD%BD/">转载</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/07/07/2020070716/">mybatis缓存</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>本文由 <a target="_blank" rel="noopener" href="http://ksria.com/simpread/">简悦 SimpRead</a> 转码， 原文地址 <a target="_blank" rel="noopener" href="http://www.mybatis.cn/archives/762.html">http://www.mybatis.cn/archives/762.html</a></p>
</blockquote>
<p>计算机有两大基本的功能：计算和存储。在存储方面，缓存的设计和实现也是一门学问。这门学问里面包含什么门道呢？不妨研究一下 MyBatis 缓存类 PerpetualCache，一定会大有收获的。</p>
<p>在 MyBatis 里面，存在一个 PerpetualCache，它是一级缓存、二级缓存的最基本实现，但 PerpetualCache 只不过包装了一下 HashMap。Perpetual 是 “永久、不间断” 之意，以 PerpetualCache 为根本，在 cache.decorators 包里面有多种缓存的代理，实现了各种清除策略。</p>
<h2 id="1、PerpetualCache-名字的含义"><a href="#1、PerpetualCache-名字的含义" class="headerlink" title="1、PerpetualCache 名字的含义"></a>1、PerpetualCache 名字的含义</h2><p>Perpetual 是 “永久、不间断” 之意，为什么这么命名呢？稍加联系，便能明白。缓存的设计有两个重点问题：如何存储数据和采用何种清除策略。存储的话，用哈希表即可完美解决。对于清除策略而言，往往有多种选择。MyBatis 作者 Clinton Begin 选择 Perpetual 来命名缓存，暗示这是一个最底层的缓存，数据一旦存储进来，永不清除，如果实现清除策略，请把 Perpetual 包装一下。在 cache.decorators 包里面有多种缓存，它们内部串联的主线就是按照 “不同的清除策略” 来贯穿的。</p>
<p><img src="http://www.mybatis.cn/usr/uploads/2019/10/297015096.jpg"></p>
<h2 id="2、PerpetualCache-的实现原理："><a href="#2、PerpetualCache-的实现原理：" class="headerlink" title="2、PerpetualCache 的实现原理："></a>2、PerpetualCache 的实现原理：</h2><p>PerpetualCache 仅仅是包装了 HashMap，代码如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">public class PerpetualCache implements Cache </span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  private final String id;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  private Map&lt;Object, Object&gt; cache = new HashMap&lt;Object, Object&gt;();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>PerpetualCache 的读取数据，也是通过内部的 HashMap 来实现的，代码如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line"></span><br><span class="line">public void putObject(Object key, Object value) &#123;</span><br><span class="line"></span><br><span class="line">cache.put(key, value);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line"></span><br><span class="line">public Object getObject(Object key) &#123;</span><br><span class="line"></span><br><span class="line">return cache.get(key);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line"></span><br><span class="line">public Object removeObject(Object key) &#123;</span><br><span class="line"></span><br><span class="line">return cache.remove(key);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line"></span><br><span class="line">public void clear() &#123;</span><br><span class="line"></span><br><span class="line">cache.clear();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="3、Key-的设计：CacheKey"><a href="#3、Key-的设计：CacheKey" class="headerlink" title="3、Key 的设计：CacheKey"></a>3、Key 的设计：CacheKey</h2><p>在 PerpetualCache 内部使用的 Java 自带的 HashMap：</p>
<p>Map&lt;Object, Object&gt; cache = new HashMap&lt;Object, Object&gt;();</p>
<p>但是，HashMap 的 Key 设计略显单薄，无法适应复杂的缓存场景，需要进行自定义设计。MyBatis 实现了 CacheKey 类，其功能非常的强大。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">public class CacheKey implements Cloneable, Serializable</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    private final int multiplier;</span><br><span class="line"></span><br><span class="line">    private int hashcode;</span><br><span class="line"></span><br><span class="line">    private long checksum;</span><br><span class="line"></span><br><span class="line">    private int count;</span><br><span class="line"></span><br><span class="line">    private List&lt;Object&gt; updateList;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>代码分析如下所示：</p>
<p>（1）hashcode，用于表示 CacheKey 的哈希码<br>（2）checksum，总和校验，当出现复合 key 的时候，分布计算每个 key 的哈希码，然后求总和<br>（3）count，当出现复合 key 的时候，计算 key 的总个数<br>（4）updateList，当出现复合 key 的时候，保存每个 key</p>
<p>CacheKey 这个类设计的非常好，个人推荐感兴趣的人可以仔细读一读其源码。其初始化的过程如下所示:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">public CacheKey(Object[] objects)</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    this();</span><br><span class="line"></span><br><span class="line">    updateAll(objects);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public void updateAll(Object[] objects)</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    for (Object o : objects)</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        update(o);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public void update(Object object)</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    int baseHashCode = object == null ? 1 : ArrayUtil.hashCode(object);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    count++;</span><br><span class="line"></span><br><span class="line">    checksum += baseHashCode;</span><br><span class="line"></span><br><span class="line">    baseHashCode *= count;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    hashcode = multiplier * hashcode + baseHashCode;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    updateList.add(object);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://pcbopcbo.github.io/2020/07/07/2020070716/" data-id="ckpxpgin9000xccub0i90gxnw" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mybatis/" rel="tag">mybatis</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%BC%80%E5%8F%91/" rel="tag">开发</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%BD%AC%E8%BD%BD/" rel="tag">转载</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2020070711" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/07/07/2020070711/" class="article-date">
  <time datetime="2020-07-07T02:57:11.000Z" itemprop="datePublished">2020-07-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%A4%87%E8%AE%B0/">备记</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/07/07/2020070711/">Mybatis相关链接点</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Mybatis（Object-relation-mapping）"><a href="#Mybatis（Object-relation-mapping）" class="headerlink" title="Mybatis（Object relation mapping）"></a>Mybatis（Object relation mapping）</h2><h3 id="JDBC"><a href="#JDBC" class="headerlink" title="JDBC"></a>JDBC</h3><pre><code>1. 不支持线程池，每次连接数据库的开销较大

2. sql需要写在代码中，返回结果的处理需要硬编码，修改后需要整体编译

3. 五步：加载驱动-&gt;创建连接-&gt;创建statement-&gt;执行sql-&gt;解析结果
</code></pre>
<h3 id="MYBATIS"><a href="#MYBATIS" class="headerlink" title="MYBATIS"></a>MYBATIS</h3><pre><code>是一个封装了JDBC的对象关系映射框架，相比于原生的jdbc，节省了大量的重复性操作。从加载驱动到解析结果中，仅仅需要将必须的数据库配置信息、对象信息。

但同时，又提供了相当一部分的灵活性，可以在不同的业务场景下允许架构人员进行灵活的扩展。

可以使用xml或者注解配置或者映射原生信息，以对象作为参数动态生成执行sql，再通过映射获取结果对象。
</code></pre>
<p>​<br>​<br><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/java-api.html">Mybatis 官方网址</a><br>​<br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/121646778">可关注点，一般这些也是比较常用的点</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/66795003">MyBatis框架详解!!!(上篇)</a></p>
<h4 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h4><pre><code>相对于jdbc，节省大量的编码与精力，专注于sql。

基于jdbc的封装框架，所以可以很好的兼容数据库。

非常容易的与spring集成

提供xml便签，对象关系映射，面向表结构编程、灵活性高。
</code></pre>
<h4 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h4><pre><code>移植性差、sql语句编写量大。
</code></pre>
<h4 id="适合场景"><a href="#适合场景" class="headerlink" title="适合场景"></a>适合场景</h4><pre><code>需求变化大、性能要求严格。
</code></pre>
<h4 id="Hibernate-JPA"><a href="#Hibernate-JPA" class="headerlink" title="Hibernate/JPA"></a>Hibernate/JPA</h4><pre><code>Hibernate、JPA与Mybatis的争论各有各的理由，具体的起因分析等，可以阅读下面的知乎回答。
</code></pre>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/109324776">为啥国人偏爱 Mybatis，而老外喜欢 Hibernate/JPA 呢？</a></p>
<p><img src="https://pic.downk.cc/item/5f04266314195aa594790bac.jpg" alt="Mybatis VS Hibernate"></p>
<p><img src="https://pic.downk.cc/item/5f0426b014195aa59479296e.jpg" alt="Mybatis VS Hibernate2"></p>
<h4 id="mybatis-一些插件扩展等"><a href="#mybatis-一些插件扩展等" class="headerlink" title="mybatis 一些插件扩展等"></a>mybatis 一些插件扩展等</h4><p><a target="_blank" rel="noopener" href="https://github.com/abel533/Mapper">tkmapper github地址</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/abel533/Mapper/wiki/1.1-java">tkmapper github文档地址</a></p>
<p><a target="_blank" rel="noopener" href="https://mp.baomidou.com/">Mybatis-Plus 地址</a></p>
<p><a target="_blank" rel="noopener" href="http://mybatis.org/spring/zh/">mybatis spring</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://pcbopcbo.github.io/2020/07/07/2020070711/" data-id="ckpxpgin8000uccub3f1013k9" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mybatis/" rel="tag">mybatis</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%BC%80%E5%8F%91/" rel="tag">开发</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%91%98%E6%8A%84/" rel="tag">摘抄</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2020062316" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/06/23/2020062316/" class="article-date">
  <time datetime="2020-06-23T07:21:49.000Z" itemprop="datePublished">2020-06-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%BD%AC%E8%BD%BD/">转载</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/06/23/2020062316/">制作 SSH 登录远程服务器的 Shell 脚本</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>本文由 <a target="_blank" rel="noopener" href="http://ksria.com/simpread/">简悦 SimpRead</a> 转码， 原文地址 <a target="_blank" rel="noopener" href="https://blog.csdn.net/kaikai136412162/article/details/80743641">https://blog.csdn.net/kaikai136412162/article/details/80743641</a></p>
</blockquote>
<p>制作 SSH 登录远程服务器的 Shell 脚本</p>
<p>Ubuntu 环境需要安装 expect 安装包</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install expect</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>使用 shell 脚本自动 ssh 登录远程服务器</p>
<p>login.sh</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/expect -f</span><br><span class="line"># 设置ssh连接的用户名</span><br><span class="line">set user liuben</span><br><span class="line"># 设置ssh连接的host地址</span><br><span class="line">set host 10.211.55.4</span><br><span class="line"># 设置ssh连接的port端口号</span><br><span class="line">set port 9999</span><br><span class="line"># 设置ssh连接的登录密码</span><br><span class="line">set password admin</span><br><span class="line"># 设置ssh连接的超时时间</span><br><span class="line">set timeout -1</span><br><span class="line"> </span><br><span class="line">spawn ssh $user@$host -p $port</span><br><span class="line">expect &quot;*password:&quot;</span><br><span class="line"># 提交密码</span><br><span class="line">send &quot;$password\r&quot;</span><br><span class="line"># 控制权移交</span><br><span class="line">interact</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 确定login.sh脚本有可执行权限</span><br><span class="line">chmod +x login.sh</span><br><span class="line"># 执行login.sh脚本</span><br><span class="line">./login.sh</span><br><span class="line"># 第二种给脚本有可执行权限</span><br><span class="line">[root]# chmod 777 ./login.sh</span><br><span class="line">[root]# ./login.sh</span><br><span class="line"> </span><br><span class="line"># 注意</span><br><span class="line">不能按照习惯来用sh login.sh来这行expect的程序，会提示找不到命令，如下：</span><br><span class="line"> </span><br><span class="line">login.sh: line 3: spawn: command not found</span><br><span class="line">couldn&#x27;t read file &quot;*password:&quot;: no such file or directory</span><br><span class="line">login.sh: line 5: send: command not found</span><br><span class="line">login.sh: line 6: interact: command not found</span><br><span class="line">因为expect用的不是bash所以会报错。因为bash和expect的脚本指定了不同的脚本解释器</span><br><span class="line">#!/usr/bin/expect -f</span><br><span class="line">#!/bin/bash</span><br><span class="line">执行的时候直接./login.sh就可以了。～切记！</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://pcbopcbo.github.io/2020/06/23/2020062316/" data-id="ckpxpgin4000pccub9z287df5" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%91%98%E6%8A%84/" rel="tag">摘抄</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2020062317" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/06/23/2020062317/" class="article-date">
  <time datetime="2020-06-23T07:21:49.000Z" itemprop="datePublished">2020-06-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%BD%AC%E8%BD%BD/">转载</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/06/23/2020062317/">使用shell登录远程服务器执行多条命令，ssh登录之后执行脚本文件</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>本文由 <a target="_blank" rel="noopener" href="http://ksria.com/simpread/">简悦 SimpRead</a> 转码， 原文地址 <a target="_blank" rel="noopener" href="https://www.cnblogs.com/HYanqing/p/11687498.html">https://www.cnblogs.com/HYanqing/p/11687498.html</a></p>
</blockquote>
<p>这个需求主要是我在 jenkins 中 pipeline 的代码里，需要使用 shell 语言执行远程连接并且部署的工作，但是大多数的 shell 和服务器交互是使用 expect 解释器 就是之前我写过的那个关于 expect 有关的文章，问题是 jenkins 中默认的 shell 解释器只有 bash，不能更改解释器的。所以就很难受，国内的百度基本都是搬运过来的内容，毫无意义，浪费时间，在国外博客浪荡几天之后终于找到了解决方案。</p>
<p>下面我来分享一下，大致意思呢就是执行完 ssh 连接远程主机之后需要执行的命令，可以进行如下操作，命令不要照抄，换成你自己的 user 名和 ip 地址。</p>
<p>【我在我自己电脑和服务器之间都配置了 ssh 免密码登录 直接使用 ssh IP 地址就可以登录了，强烈建议配置 ssh，非常方便】</p>
<h2 id="1，登录远程主机执行单条命令"><a href="#1，登录远程主机执行单条命令" class="headerlink" title="1，登录远程主机执行单条命令"></a>1，登录远程主机执行单条命令</h2><p>登录完主机之后执行一条命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1 $ ssh USER@HOST &#x27;COMMAND&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>获取远程主机的最新更新时间</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1 $ ssh root@192.168.1.1 &#x27;uptime&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>登录完远程主机就进行重启远程主机</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1 $ ssh root@192.168.1.1 &#x27;reboot&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>那么问题出来了，上面的都是执行一条命令，那如果我需要执行多条命令怎么办呢？之前困扰我最大的问题就是这个，执行多条命令，虽然直接堆叠多条 ssh 登录的语句 那些前缀也可以，但是看着就恶心。这样我们就可以使用以下几个方案, 原内容如下，我做了备注，这样比较一目了然。</p>
<h2 id="2，登录远程主机执行多条命令"><a href="#2，登录远程主机执行多条命令" class="headerlink" title="2，登录远程主机执行多条命令"></a>2，登录远程主机执行多条命令</h2><p><img src="https://pic.downk.cc/item/5ef1b03f14195aa594f06670.jpg"></p>
<p> 可能还有小伙伴会问，如果需要 ssh 登录远程之后执行指定的脚本文件怎么做？</p>
<p>3，登录远程主机执行指定脚本文件<br> <img src="https://pic.downk.cc/item/5ef1b07014195aa594f091ff.jpg"> </p>
<p>由此来看，英文还是非常重要的。不然遇到问题你都不知道怎么去搜了，不是我埋汰百度，确实国内搬运回答问题现象太严重，点进去一个除了站点不一样 内容都一样 连错别字都一样，如果你是经常和计算机打交道的一定下载个谷歌浏览器，必须可以使用谷歌，可以配置插件或者配置翻墙设备。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://pcbopcbo.github.io/2020/06/23/2020062317/" data-id="ckpxpgin5000qccubgdqz2l35" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/shell/" rel="tag">shell</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%BD%AC%E8%BD%BD/" rel="tag">转载</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">下一页 &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%8D%9A%E5%AE%A2/">博客</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%A4%87%E8%AE%B0/">备记</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8B%93%E5%B1%95/">拓展</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%BD%AC%E8%BD%BD/">转载</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mybatis/" rel="tag">mybatis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/" rel="tag">redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shell/" rel="tag">shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/springboot/" rel="tag">springboot</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vim/" rel="tag">vim</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8D%9A%E5%AE%A2/" rel="tag">博客</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BC%80%E5%8F%91/" rel="tag">开发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%91%98%E6%8A%84/" rel="tag">摘抄</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%96%87%E4%BB%B6%E7%BC%96%E7%A0%81/" rel="tag">文件编码</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BD%AC%E8%BD%BD/" rel="tag">转载</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86%E6%A1%86%E6%9E%B6/" rel="tag">配置管理框架</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%93%BE%E6%8E%A5%E6%94%B6%E9%9B%86/" rel="tag">链接收集</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/git/" style="font-size: 14px;">git</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/mybatis/" style="font-size: 16px;">mybatis</a> <a href="/tags/redis/" style="font-size: 10px;">redis</a> <a href="/tags/shell/" style="font-size: 12px;">shell</a> <a href="/tags/springboot/" style="font-size: 10px;">springboot</a> <a href="/tags/vim/" style="font-size: 10px;">vim</a> <a href="/tags/%E5%8D%9A%E5%AE%A2/" style="font-size: 10px;">博客</a> <a href="/tags/%E5%BC%80%E5%8F%91/" style="font-size: 18px;">开发</a> <a href="/tags/%E6%91%98%E6%8A%84/" style="font-size: 20px;">摘抄</a> <a href="/tags/%E6%96%87%E4%BB%B6%E7%BC%96%E7%A0%81/" style="font-size: 10px;">文件编码</a> <a href="/tags/%E8%BD%AC%E8%BD%BD/" style="font-size: 16px;">转载</a> <a href="/tags/%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86%E6%A1%86%E6%9E%B6/" style="font-size: 10px;">配置管理框架</a> <a href="/tags/%E9%93%BE%E6%8E%A5%E6%94%B6%E9%9B%86/" style="font-size: 12px;">链接收集</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">六月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">八月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">七月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">六月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">五月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">四月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">一月 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/06/15/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2021/06/15/2021061500/">临时性备记</a>
          </li>
        
          <li>
            <a href="/2020/08/24/2020082411/">如何防止git使用的时候的冲突与解决冲突</a>
          </li>
        
          <li>
            <a href="/2020/08/14/2020081410/">redis数据结构与底层</a>
          </li>
        
          <li>
            <a href="/2020/07/15/2020071517/">简单代码片段</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 thf<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/index.html" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>